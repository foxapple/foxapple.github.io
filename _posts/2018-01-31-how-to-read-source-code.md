---
layout: post
title: 如何才能读懂复杂的代码
---
# 如何才能读懂复杂的代码
---

这两天工作不多，我一直在阅读业务代码，由于是 Android 的 framework 层的代码，自己不知如何下手，于是去知乎取经，看到了大多数人的观点还是，最一开始的时候要抓住主线，不要管细节。等上手后再慢慢补充细节，这样的方式，我回想了这两周我看的源码，自己总结的 workflow，确实是一个相同的道理。所以我就想在具体的描述一下这个方法，并且不局限于 Android framework 层的代码。

### 阅读一个复杂的代码工程

复杂的代码工程往往不止一个文件，而是由数十个代码文件组成的，甚至是上百的文件组成。这样的一个代码工程，首先你应该想好自己想看这个工程什么功能，然后再去具体看相关的代码。目的性应该是最重要的一点了吧，如果仅仅抱着想多了解这段代码的结构，往往就会不知所云————代码都是先有目的再有实现的。接下来的几点建议都是通过抓住代码的主线来阅读。

1. 时刻要明白代码的意义
	在跟着代码的时候，时时刻刻要明白，代码流进行到什么步骤了。如果记不住流程的话，可以把重要的函数记下来，在备注这个函数做了一个什么工作。这里的了解只要有一个大概的印象就好了，不需要太仔细，尤其是第一次，只要知道说这段代码存了个值，或者更新了下 view 这样的程度就够了。这样才能了解代码整体的流程。而不是单纯知道代码是怎么运行的。

2. 只看代码的主分支
	在看代码时，如果出现了多个分支，那么只看主要分支，或者最主要的分支。比如 PackageInstaller 在卸载软件时，卸载失败的处理有很多代码。这部分我们在看的时候要跳过去，只看卸载成功的部分。

3. 保持在一个层面上阅读代码
	在阅读源码的时候，只看本工程的代码，不要往下层扎。这是阅读的平级移动，这可以更好的抓住自己的注意力。防止注意力被下层的复杂代码所干扰了。

这就是抓住代码主线的一些建议。

### 找对代码程序的入口

找对程序启动的入口，就相当于成功了一半。对于 Android 工程来说，为我们提供了很多范式，工程师往往会按照 Android 设计的架构进行开发，这当然方便了我们。我们要找的程序启动入口，Android 已经为我们写好了，只要去找就可以找到。下面说几个 Android 里常见的入口。

1. Activity 生命周期
	对于一个 Activity 来说，它的生命周期大部分情况是都要经历的，如果你想了解一个 App 启动后是如何运行的，那么就可以从 onCreate 函数看起，如果想看程序是如何更新的界面的，可以从 onResume 看起。如果想看 App 最后是如何回收资源，持久化数据的，就可以从 onDestroy 函数开始看。

2. Android 各种响应事件
	对于不同的事件，直接去看监听了这个事件的函数是一个非常好的办法。如果想看点击后发生了什么，当然是要从 onClick 函数看起，Android 还有很多的事件，通过事件监听实现功能是一种特别常见的方法，直接搜索这种方法实现，接着继续追踪下去。

3. 查看接受 Android 广播的 Receiver 
	广播也是 Android 里特别常见的用法。对于一些行为，Android 系统会发送特定的广播，这些广播都有自己的名字，按着名字去搜索，就能找到程序的入口啦。这也是一个常见的找入口方法。

### 阅读源码的好处

这个说起来就显得太空泛了，但是我还是要说！

代码是最清晰的描述了（不过也是要看质量的），谷歌开发的 Android 系统代码质量当然没得说，如果想了解 Android 哪个模块的机制，最好的就是直接去读 Android 代码。Android 源码有很多的注释，读起来并不晦涩。

当然读源码主要是为了看实现，如果只想看 Android 的一些组件方法怎么用，可以去看博客，看入门书籍，确实是很有效的方法。

但是到了后面，就有很多疑难杂症 bug，需要去深入了解 Android 的机制，而不是单纯的用，就该看 Android 的源码了。看代码自己研究，比看博主研究完给你讲更有效。大部分博主的『深入了解 Android XX机制』都是放一大段代码，讲一句自己的理解。博主的目标和兴趣与你的不同，你看起来很可能没有太大的成就感，而且不是你自己顺着代码看下下来的，印象也不会深。总之，自己看源码要强于看别的博主总结好的源码。

如果你是中途加入一个小组，没有参与开发，需要解决 bug 的时候，那么更需要好好地阅读源码了。对 bug 涉及到的流程过一遍，就会找到大部分问题的所在，问题解多了，对整个工程的了解也更加深入

以上。





































